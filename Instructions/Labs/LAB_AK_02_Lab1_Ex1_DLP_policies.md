---
lab:
  title: 演習 1 - DLP ポリシーを管理する
  module: Module 2 - Implement Data Loss Prevention
---
## WWL テナント - 使用条件

講師が指導するトレーニング配信の一環としてテナントを提供されている場合は、講師が指導するトレーニングでハンズオンラボをサポートする目的でテナントを利用できることに注意してください。

テナントを共有したり、ハンズオンラボ以外の目的で使用したりしないでください。 このコースで使われるテナントは試用版テナントであり、クラスが終了し、拡張機能の対象となっていない場合は、使用したりアクセスしたりすることはできません。

テナントを有料サブスクリプションに変換することはできません。 このコースの一環として取得したテナントは Microsoft Corporation の財産のままであり、当社はいつでもアクセス権とリポジトリを取得する権利を留保します。

# ラボ 2 演習 1 - DLP ポリシーを管理する

あなたは Contoso Ltd. が新しく採用したコンプライアンス管理者、Joni Sherman です。データ損失防止の目的で、組織の Microsoft 365 テナントを構成する任務を負っています。 Contoso Ltd. は米国で運転指導を提供している会社であり、顧客の機密情報が組織から流出しないようにする必要があります。

## タスク 1 - テスト モード で DLP ポリシーを作成する

この演習では、Microsoft Purview ポータルでデータ損失防止ポリシーを作成し、ユーザーによる機密データの共有を防止します。 作成する DLP ポリシーは、ユーザーがクレジット カード情報を含むコンテンツを共有したい場合に通知を行い、この情報を送信する正当な理由を提供する機会を提供します。 このブロックのアクションがユーザーに影響を与えないよう、このポリシーはテスト モードで実行されます。

1. Client 1 VM (LON-CL1) に **lon-cl1\admin** アカウントでログインします。

1. **Microsoft Edge** で、 **`https://compliance.microsoft.com`** に移動し、**Joni Sherman** として Microsoft Purview ポータルにログインします。 JoniS@WWLxZZZZZZ.onmicrosoft.com としてサインインします (ZZZZZZ はラボ ホスティング プロバイダーから支給された固有のテナント ID)。  Joni のパスワードは、ラボ ホスティング プロバイダーから支給されます。

1. **[サインインの状態を維持しますか?]** ダイアログボックスが表示されたら、 **[今後、このメッセージを表示しない]** チェックボックスをオンにし、 **[いいえ]** を選択します。

1. **Microsoft Purview** ポータルの左側のナビゲーション ウィンドウで **[データ損失防止]** を展開し、**[ポリシー]** を選択します。

1. **[ポリシー]** ページで **[+ ポリシーの作成]** を選択し、新しいデータ損失防止ポリシーを作成するウィザードを起動します。

1. **[テンプレートの利用またはカスタム ポリシーの作成]** ページで、下にスクロールし、 **[カテゴリ]** で **[カスタム]** を選択し、 **[テンプレート]** で **[カスタム ポリシー]** を選択します。 既定では、どちらのオプションも既に選択されています。 **[次へ]** を選択します。

1. **[DLP ポリシーの名前の設定]** ページで、以下を入力します。

   - **名前**: クレジット カードの DLP ポリシー
   - **説明**: クレジット カード番号が共有されないよう保護する

1. [**次へ**] を選択します。

1. **[管理ユニットの割り当て (プレビュー)]** ページで、 **[次へ]** を選択します。

1. **[ポリシーを適用する場所の選択]** ページで **[Teams のチャットおよびチャネル メッセージ]** オプションのみを [有効] にし、 **[次へ]** を選択します。

1. **[ポリシー設定の定義]** ページで、 **[詳細な DLP ルールを作成またはカスタマイズする]** を選択し、 **[次へ]** を選択します。

1. **[詳細な DLP ルールをカスタマイズする]** ページで、**[+ ルールの作成]** を選択します。

1. **[ルールの作成]** ポップアップ ページの **[名前]** フィールドに、 _「クレジット カード情報」_ と入力します。

1. **[条件]** で、**[+ 条件の追加]** を選択し、ドロップダウン メニューから **[コンテンツに含まれている]** を選択します。

1. 新しい **[コンテンツに含まれている]** 領域で、 **[追加]** を選択し、ドロップダウン メニューから **[機密情報の種類]** を選択します。

1. **[機密情報の種類]** ページで **[Credit Card Number]** を選択し、**[追加]** を選択します。

1. **[ルールの作成]** ページで **[+ 条件の追加]** を選択し、ドロップダウン メニューから **[コンテンツが Microsoft 365 から共有されている]** を選択します。

1. **[Microsoft 365 からコンテンツを共有する]** セクションで、 **[組織内の連絡先のみ]** オプションを選択します。

1. **[ルールの作成]** ページで、 **[+ 処理の追加]** を選択します。 **[Microsoft 365 の場所にあるコンテンツへのアクセスを制限またはコンテンツを暗号化する]** をクリックして、 **[すべてのユーザーをブロックします。]** を選択します。

1. **[ルールの作成]** ページの **[ユーザーへの通知]** セクションで、スイッチを **[オン]** にしてユーザーへの通知を有効にします。

1. チェック ボックスをオンにして、 **[Notify users in Office 365 service with a policy tip] (Office 365 サービスのユーザーにポリシー ヒントの通知を表示する)** を有効にします。

1. **［ユーザーによる上書き** で、**M365 サービスからの上書きを許可します。Exchange、Sharepoint、OneDrive、Teams でのユーザーによるポリシー制限の上書きを許可します。** のチェックボックスをオンにします。

1. **[上書きするには業務上の理由が必要です]** チェックボックスをオンにします。

1. **[インシデント レポート]** セクションの **[管理者のアラートとレポートでこの重大度レベルを使用する]** ドロップダウンで **[低]** を選択します。

1. **[ルールの作成]** ページで **[保存]** を選択し、 **[次へ]** を選択します。

1. **[ポリシー モード]** ページで、 **[シミュレーション モードでポリシーを実行する]** を選択し、 **[シミュレーション モード中にポリシー ヒントを表示します]** を選択します。

1. **[ポリシーの確認と作成]** ページで設定を確認し、 **[送信]** を選択します。

1. **[新しいポリシーが作成されました]** ページで、 **[完了]** を選択します。

これで、Microsoft Teams のチャットおよびチャンネルでクレジット カード番号をスキャンし、ポリシーをオーバーライドする業務上の正当な理由をユーザーが提供できるようにする DLP ポリシーが作成されました。

## タスク 2 - DLP ポリシーを修正する

このタスクでは、前の手順で作成した既存の DLP ポリシーを変更して、メールでもクレジット カード情報をスキャンし、メール内のこのコンテンツをユーザーが共有する必要がある場合、ユーザーに通知します。

1. Client 1 VM (LON-CL1) には **lon-cl1\admin** アカウントでログインし、Microsoft 365 には **Joni Sherman** としてログインしておく必要があります。

1. **Microsoft Edge** で、Microsoft Purview ポータルのタブがまだ開かれているはずです。 その場合は、それを選択して次の手順に進みます。 閉じた場合は、新しいタブで **`https://compliance.microsoft.com`** に移動します。

1. **Microsoft Purview** ポータルの左側のナビゲーション ウィンドウで **[データ損失防止]** を展開し、**[ポリシー]** を選択します。

1. **[ポリシー]** ページで、先ほど作成した **[クレジット カードの DLP ポリシー]** の横にあるチェック ボックスをオンにし、 **[ポリシーの編集]** (鉛筆アイコン) を選択してポリシー ウィザードを開きます。

1. **[DLP ポリシーの名前の設定]** ページで **[次へ]** を選択します。

1. **[管理単位の割り当て (プレビュー)]** ページで、 **[次へ]** を選択します。

1. **[ポリシーを適用する場所を選択する]** ページで、**[Exchange メール]** オプションを有効にしたら、**[ポリシーの確認と作成]** ページが開くまで **[次へ]** を選択します。

1. **[送信]** を選択して、行った変更をポリシーに適用します。

1. ポリシーが更新されたら、**[完了]** を選択します。

既存の DLP ポリシーが修正され、コンテンツを探してスキャンする場所が変更されました。

## タスク 3 - PowerShell に DLP ポリシーを作成する

このタスクでは、PowerShell を使用して、Contoso EmployeeID を保護し、それらが Exchange で共有されるのを防止する DLP ポリシーを作成します。 ユーザーには、機密データが共有されようとしていることと、Contoso EmployeeID が含まれるメールの送信はブロックされることが通知されます。

1. 引き続き Client 1 VM (LON-CL1) に **lon-cl1\admin** アカウントでログインしている必要があります。  

1. スタート メニューで、**Windows PowerShell** を選択します。

1. **PowerShell** ウィンドウで、次のように入力し、

   ```powershell
   Connect-IPPSSession
   ```

   **Joni Sherman** JoniS@WWLxZZZZZZ.onmicrosoft.com としてサインインします (ZZZZZZ はラボ ホスティング プロバイダーから支給された固有のテナント ID)。  Joni のパスワードは、ラボ ホスティング プロバイダーから支給されます。

1. 次のコマンドを PowerShell に入力し、すべての Exchange メールボックスをスキャンする DLP ポリシーを作成します。

   ```powershell
   New-DlpCompliancePolicy -Name "EmployeeID DLP Policy" -Comment "This policy blocks sharing of Employee IDs" -ExchangeLocation All
   ```

1. 次のコマンドを PowerShell に入力し、前のステップで作成した DLP ポリシーに DLP ルールを追加します。

   ```powershell
   New-DlpComplianceRule -Name "EmployeeID DLP rule" -Policy "EmployeeID DLP Policy" -BlockAccess $true -ContentContainsSensitiveInformation @{Name="Contoso 従業員 ID"}
   ```

1. 次のコマンドを使用して、"**EmployeeID の DLP ルール**" を確認します。

   ```powershell
   Get-DLPComplianceRule -Identity "EmployeeID DLP rule"
   ```

これで、PowerShell を使用して Exchange で Contoso EmployeeID をスキャンする DLP ポリシーが作成されました。

## タスク 4 - DLP ポリシーをテストする

このタスクでは、前のタスクで作成した DLP ポリシーをテストします。

1. Client 1 VM (LON-CL1) には **lon-cl1\admin** アカウントでログインし、Microsoft 365 には Joni Sherman としてログインしておく必要があります。

1. Microsoft Edge ブラウザー ウィンドウを開き、 **`https://outlook.office.com/`** に移動します。

1. 左上にある **[新しいメール]** ボタンを選択して、新しいメール メッセージを作成します。

1. **[宛先]** フィールドに 「_Megan_」と入力し、**Megan Bowen** のメール アドレスを選択します。

1. [件名] フィールドに、 _「従業員情報に関するヘルプ」_ と入力します。

1. メールの本文には、次の内容を入力します。

   ``` text
   Please help me with the start dates for the following employees:
   ABC123456
   DEF678901
   GHI234567

   Thank you, 
   Joni Sherman
   ```

1. メッセージ ウィンドウの右上にある **[送信]** ボタンを選択して、メールを送信します。

1. メールが配信不能であり、DLP ポリシーによってブロックされたことを示すメッセージを受信します。

      ![[ロールの管理] オプションのスクリーンショット](../Media/dlp-email-blocked.png)

これで、DLP ポリシーのテストに成功しました。

## タスク 5 - テスト モードでポリシーをアクティブにする

このタスクでは、テストモードで作成したクレジット カード情報の DLP ポリシーをアクティブ化し、保護アクションを強化します。

1. Client 1 VM (LON-CL1) には **lon-cl1\admin** アカウントでログインし、Microsoft 365 には **Joni Sherman** としてログインしておく必要があります。

1. **Microsoft Edge** で、Microsoft Purview ポータルのタブがまだ開かれているはずです。 その場合は、それを選択して次の手順に進みます。 閉じた場合は、新しいタブで **`https://compliance.microsoft.com`** に移動します。

1. **Microsoft Purview** ポータルの左側のナビゲーション ウィンドウで **[データ損失防止]** を展開し、**[ポリシー]** を選択します。

1. **[ポリシー]** ページで **[クレジット カードの DLP ポリシー]** の横にあるチェック ボックスをオンにし、 **[ポリシーの編集]** (鉛筆) を選択してポリシー ウィザードを開きます。

1. **[ポリシー モード]** ページが表示されるまで **[次へ]** を選択し、 **[すぐに有効にする]** を選択します。

1. **[ポリシーの確認と作成]** で **[送信]** を選択します。

1. **[Policy updated] (ポリシーが更新されました)** ページで、 **[完了]** を選択します。

DLP ポリシーがアクティブ化されました。 ポリシーはクレジット カード情報を共有しようとする試みを探知すると、それをブロックし、ユーザーにはそのブロックのアクションをオーバーライドする業務上の正当な理由を提供することを許可します。

## タスク 6 - ポリシーの優先順位を修正する

DLP ポリシーを 2 つ作成したところで、より制限の厳しいポリシーが、より制限の緩いポリシーより優先して処理されるようにします。 このため、EmployeeID の DLP ポリシーにより高い優先順位を与えます。

1. Client 1 VM (LON-CL1) には **lon-cl1\admin** アカウントでログインし、Microsoft 365 には **Joni Sherman** としてログインしておく必要があります。

1. **Microsoft Edge** で、Microsoft Purview ポータルのタブがまだ開かれているはずです。 その場合は、それを選択して次の手順に進みます。 閉じた場合は、新しいタブで **`https://compliance.microsoft.com`** に移動します。

1. **Microsoft Purview** ポータルの左側のナビゲーション ウィンドウで **[データ損失防止]** を展開し、**[ポリシー]** を選択します。

1. **[ポリシー]** タブで **[EmployeeID の DLP ポリシー]** の横にある 3 つの縦向きドットを選択し、 **[アクション]** の選択項目を開いて **[先頭へ移動]** を選択します。

1. **[データ損失防止]** ウィンドウで、 **[更新]** を選択し、[ポリシー] タブの **[順序]** の列で優先順位を確認します。

DLP ポリシーの優先順位が修正されました。 両方のポリシーが同じコンテンツに一致する場合、より高い優先順位を持つアクションが実行されます。

## タスク 7 - Microsoft 365 Defender でファイルの監視を有効にする

Microsoft 365 Defender のファイル ポリシーを使用し、OneDrive と SharePoint Online の場所にあるファイルを保護します。 ファイル ポリシーを作成するには、組織内のファイルを Microsoft 365 Defender でスキャンできるようにファイル監視を有効にする必要があります。

1. 引き続き Client 1 VM (LON-CL1) に **lon-cl1\admin** アカウントでログインしている必要があります。

1. **Microsoft Edge** で、Microsoft Purview ポータルのタブがまだ開かれているはずです。 右上にある Joni Sherman の **[プロフィール画像]** を選択し、 **[サインアウト]** を選択したら、ブラウザーを閉じます。

1. **Microsoft Edge** を開き、 **`https://security.microsoft.com`** に移動して Microsoft 365 Defender ポータルに **MOD 管理者** admin@WWLxZZZZZZ.onmicrosoft.com としてログインします (ZZZZZZ はラボ ホスティング プロバイダーから支給された固有のテナント ID)。 管理者のパスワードは、ラボ ホスティング プロバイダーから支給されます。

1. 左側のナビゲーション ウィンドウで下にスクロールし、 **[設定]** を選択します。

1. **[設定]** ページで **[クラウド アプリ]** を選択します。

1. **[クラウド アプリ]** ウィンドウ内の左側のペインで、 **[情報の保護]** セクションまで下にスクロールし、 **[ファイル]** を選択します。

1. まだマークされていない場合は、 **[ファイル監視を有効にする]** チェックボックスを選択し、 **[保存]** を選択します。

Microsoft 365 Defender でファイル監視が有効になりました。これでファイル ポリシーを使用して、機密性の高いコンテンツのファイルをスキャンできるようになりました。

## タスク 8 - Microsoft 365 Defender のファイル ポリシーを作成する

このタスクでは、Microsoft 365 Defender でファイル ポリシーを作成し、OneDrive と SharePoint Online のファイルをスキャンして、クレジット カード情報を含むファイルが共有されている場合はそのファイルに対して自動的に検疫を行います。

1. 引き続き Client 1 VM (LON-CL1) に **lon-cl1\admin** アカウントでログインしている必要があります。

1. **Microsoft Edge** に、Microsoft Defender for Cloud Apps ポータルのタブがまだ開かれているはずです。 右上にある MOD 管理者の **[プロフィール画像]** を選択し、歯車の横にある **[サインアウト]** を選択したら、ブラウザーを閉じます。

1. **Microsoft Edge** を開き、 **`https://security.microsoft.com`** に移動し、Microsoft 365 Defender ポータルに **Joni Sherman** JoniS@WWLxZZZZZZ.onmicrosoft.com としてログインします (ZZZZZZ はラボ ホスティング プロバイダーから支給された固有のテナント ID)。 Joni Shermans のパスワードは、ラボ ホスティング プロバイダーから支給されます。

1. **Microsoft 365 Defender** ポータルの左側のナビゲーションで、 **[クラウド アプリ]** セクションまで下にスクロールし、 **[ファイル]** を選択します。

1. **[ファイル]** ページで、 **[+ 検索に基づく新しいポリシー]** を選択します。

1. **[ファイル ポリシーの作成]** ページで、 **[ポリシー テンプレート]** の選択を **[テンプレートなし]** のままにします。

1. **[ファイル ポリシーの作成]** ページでこちらの情報を入力します

   - **ポリシー名**: ファイルのクレジット カード情報
   - **説明**: クレジット カード番号がファイルで共有されないよう保護する

1. **[ポリシー重要度]** は **[低]** (ライトが 1 つのアイコン) とし、 **[カテゴリー]** が **[DLP]** に設定されていることを確認します。 ファイル ポリシーでは、これが既定の設定です。

1. **[次のすべてに一致するファイル]** 領域で、ドロップダウン メニュー **[パブリック (インターネット)、外部、パブリック]** を展開し、 **[内部]** を追加します。

1. **[検査方法]** ドロップダウン メニューで **[データ分類サービス]** を選択します。

1. **[検査の種類を選択]** ドロップダウン メニューで **[機密情報の種類]** を選択します。

1. **[機密情報の種類の選択]** ダイアログで、 **[クレジット カード番号]** を選択し、右上隅で **[完了]** を選択します。

1. **[アラート]** で、**[一致したファイルごとにアラートを作成する]** チェックボックスにチェックを入れ、オプションを確認します。 **[既定の設定として保存]** を選択して、設定を既定値として保存します。

1. **[ガバナンス アクション]** セクションで、**[Microsoft OneDrive for Business]** を展開し、**[ユーザー検疫に配置]** を選択します。

1. **[ガバナンス アクション]** セクションで、 **[Microsoft SharePoint Online]** を展開し、 **[ユーザー検疫に配置]** チェックボックスをオンにします。

1. ページの下部にある **[作成]** を選択します。

これで、OneDrive と SharePoint に保存されたファイルを継続的にスキャンしてクレジット カード情報を探し、組織内で共有されている場合に検疫を行うファイル ポリシーが作成されました。

## タスク 9 - Power Platform 向けの DLP ポリシーを作成する

会社では Power Automate のフローを用いて、データを SharePoint Online と Salesforce で共有します。 このタスクでは、既存のフローを続行させつつ、SharePoint Online とビジネス以外として定義されたアプリとの間でデータを共有するフローの作成を防止する、Power Platform 向けの DLP ポリシーを作成します。

1. Client 2 VM (LON-CL1) に **lon-cl2\admin** アカウントでログインします。

1. **Microsoft Edge** で、 **`https://admin.powerplatform.microsoft.com`** に移動し、Power Platform 管理センターに **MOD 管理者** admin@WWLxZZZZZZ.onmicrosoft.com としてログインします (ZZZZZZ はラボ ホスティング プロバイダーから支給された固有のテナント ID)。  管理者のパスワードは、ラボ ホスティング プロバイダーから支給されます。

1. **Power Platform 管理センター**の左側のナビゲーション ペインで、 **[ポリシー]** のドロップダウンを選択し、 **[データ ポリシー]** を選択します。

1. **[データ ポリシー]** ページで **[+ 新しいポリシー]** を選択します。

1. **[ポリシーの名前を設定]** ページで、 _「テナント規模の SharePoint ポリシー」_ と入力し、 **[次へ]** を選択します。

1. **[コネクタの割り当て]** ページの **[ビジネス以外|既定]** タブで、 **[SharePoint]** と **[Salesforce]** を選択し、ページの上部で **[ビジネスに移行]** を選択します。

1. **[コネクタの割り当て]** ページで、 **[ビジネス]** タブを選択して、SharePoint と Salesforce の両方が表示されるようにしてから **[次へ]** を選択します。

1. **[Custom connector patterns] (カスタム コネクタ パターン)** ページで、 **[次へ]** を選択します。

1. **[スコープの定義]** ページで、 **[すべての環境の追加]** を選択し、 **[次へ]** を選択します。

1. **[ポリシーの確認と作成]** ページで、ポリシーの設定を確認し、 **[ポリシーの作成]** を選択します。

SharePoint Online コネクタと Salesforce でないすべてのコネクタを利用するフローをユーザーが作成することを防止する Power Platform の DLP ポリシーが作成されました。
